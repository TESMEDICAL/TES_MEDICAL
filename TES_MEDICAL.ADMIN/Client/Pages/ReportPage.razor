@page "/donhang"

@using TES_MEDICAL.ADMIN.Client.Components
@attribute [Authorize]


<style>
    body {
        background: #f5f5f5;
        margin-top: 20px;
    }

    /* ===== Career ===== */
    .career-form {
        background-color: #4e63d7;
        border-radius: 5px;
        padding: 0 16px;
    }

        .career-form .form-control {
            background-color: rgba(255, 255, 255, 0.2);
            border: 0;
            padding: 12px 15px;
            color: #fff;
        }

            .career-form .form-control::-webkit-input-placeholder {
                /* Chrome/Opera/Safari */
                color: #fff;
            }

            .career-form .form-control::-moz-placeholder {
                /* Firefox 19+ */
                color: #fff;
            }

            .career-form .form-control:-ms-input-placeholder {
                /* IE 10+ */
                color: #fff;
            }

            .career-form .form-control:-moz-placeholder {
                /* Firefox 18- */
                color: #fff;
            }

        .career-form .custom-select {
            background-color: rgba(255, 255, 255, 0.2);
            border: 0;
            padding: 12px 15px;
            color: #fff;
            width: 100%;
            border-radius: 5px;
            text-align: left;
            height: auto;
            background-image: none;
        }

            .career-form .custom-select:focus {
                -webkit-box-shadow: none;
                box-shadow: none;
            }

        .career-form .select-container {
            position: relative;
        }

            .career-form .select-container:before {
                position: absolute;
                right: 15px;
                top: calc(50% - 14px);
                font-size: 18px;
                color: #ffffff;
                content: '\F2F9';
                font-family: "Material-Design-Iconic-Font";
            }

    .filter-result .job-box {
        -webkit-box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
        box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
        border-radius: 10px;
        padding: 10px 35px;
    }

    ul {
        list-style: none;
    }

    .list-disk li {
        list-style: none;
        margin-bottom: 12px;
    }

        .list-disk li:last-child {
            margin-bottom: 0;
        }


    .job-box .img-holder {
        height: 65px;
        width: 65px;
        font-size: 22px;
        font-weight: 700;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        border-radius: 65px;
    }

    .career-title {
        background-color: #4e63d7;
        color: #fff;
        padding: 15px;
        text-align: center;
        border-radius: 10px 10px 0 0;
        background-image: -webkit-gradient(linear, left top, right top, from(rgba(78, 99, 215, 0.9)), to(#5a85dd));
        background-image: linear-gradient(to right, rgba(78, 99, 215, 0.9) 0%, #5a85dd 100%);
    }

    .job-overview {
        -webkit-box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
        box-shadow: 0 0 35px 0 rgba(130, 130, 130, 0.2);
        border-radius: 10px;
    }

    @@media (min-width: 992px) {
        .job-overview {
            position: -webkit-sticky;
            position: sticky;
            top: 70px;
        }
    }

    .job-overview .job-detail ul {
        margin-bottom: 28px;
    }

        .job-overview .job-detail ul li {
            opacity: 0.75;
            font-weight: 600;
            margin-bottom: 15px;
        }

            .job-overview .job-detail ul li i {
                font-size: 20px;
                position: relative;
                top: 1px;
            }

    .job-overview .overview-bottom,
    .job-overview .overview-top {
        padding: 35px;
    }

    .job-content ul li {
        font-weight: 600;
        opacity: 0.75;
        border-bottom: 1px solid #ccc;
        padding: 10px 5px;
    }

    @@media (min-width: 768px) {
        .job-content ul li {
            border-bottom: 0;
            padding: 0;
        }
    }

    .job-content ul li i {
        font-size: 20px;
        position: relative;
        top: 1px;
    }

    .mb-30 {
        margin-bottom: 30px;
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css" integrity="sha256-3sPp8BkKUE7QyPSl6VfBByBroQbKxKG7tsusY2mhbVY=" crossorigin="anonymous" />
<div class="m-3">


    <div>
        <div class="d-flex flex-wrap m-2">
            <input class="mr-2 mb-2 form-control-sm" @bind="@searchPhone" placeholder="Tìm theo Tên món" />
            <select class="form-control-sm mr-2" @bind="searchTrangThai">
                <option value="0">Chọn trạng thái</option>
                <option value="1">Đang chờ xác nhận</option>
                <option value="2">Đang giao</option>
                <option value="3">Đã hoàn thành</option>
                <option value="4">Đã Hủy</option>


            </select>

            <div class="col-4">

                <button type="button" class="btn btn-success btn-sm mr-2 " @onclick="Timkiem" id="btSeach"><i class="fa fa-search" aria-hidden="true"></i>&nbsp;Lọc</button>


                <button type="button" class="btn btn-success mr-2 btn-sm" id="btSeach" @onclick="Clear"><i class="fa fa-refresh" aria-hidden="true"></i>&nbsp;Làm mới</button>
                @*@if (loading)
                    {
            <span class="spinner-border spinner-border-sm mr-1"></span>}*@
            </div>

        </div>



    </div>





</div>
<div id="nameListContainer">
    @if (!Nocontent && !loading)
    {
    <div style="min-height:400px">
        @foreach (var item in DonHangs)
        {



    <div class="job-box d-md-flex align-items-center justify-content-between mb-30 shadow p-3 mb-5 bg-white rounded">
        <div class="job-left my-4 d-md-flex align-items-center flex-wrap">
            @if (item.TrangThai == 1)
            {
    <div class="img-holder text-danger mr-md-4 mb-md-0 mb-4 mx-auto mx-md-0 d-md-none d-lg-flex" style="background-color:blue">

    </div>}
            @if (item.TrangThai == 2)
            {
    <div class="img-holder text-danger mr-md-4 mb-md-0 mb-4 mx-auto mx-md-0 d-md-none d-lg-flex" style="background-color:green">

    </div>}
            @if (item.TrangThai == 3)
            {
    <div class="img-holder text-danger mr-md-4 mb-md-0 mb-4 mx-auto mx-md-0 d-md-none d-lg-flex" style="background-color:darkcyan">

    </div>}
            @if (item.TrangThai == 4)
            {
    <div class="img-holder text-danger mr-md-4 mb-md-0 mb-4 mx-auto mx-md-0 d-md-none d-lg-flex" style="background-color:red">

    </div>}

            <div class="job-content">
                <h5 class="text-center text-md-left">@item.MaKHNavigation.Name</h5>
                <ul class="d-md-flex flex-wrap text-capitalize ff-open-sans">
                    <li class="mr-md-4">
                        <i class="zmdi zmdi-phone"></i> &nbsp; @item.Phone
                    </li>
                    <li class="mr-md-4">
                        <i class="zmdi zmdi-email"></i> &nbsp; @item.MaKHNavigation.Email
                    </li>
                    <li class="mr-md-4">
                        <i class="zmdi zmdi-calendar"></i> &nbsp; @item.ThoiGian.ToString("dd/MM/yyy HH:mm:ss")
                    </li>
                    @switch (item.TrangThai)
                    {
                        case 1:
    <li class="mr-md-4">
        <span class="badge badge-primary badge-pill">Chờ xác nhận</span>
    </li> break;
                            case 2:
    <li class="mr-md-4">
        <span class="badge badge-primary badge-pill">Đang giao</span>
    </li> break;
                            case 3:
    <li class="mr-md-4">
        <span class="badge badge-primary badge-pill">Hoàn thành</span>
    </li>
 break;
case 4:
    <li class="mr-md-4">
        <span class="badge badge-primary badge-pill">Đã hủy</span>
    </li>break;
                        }



                </ul>
                <ul class="d-md-flex flex-wrap text-capitalize ff-open-sans">
                    <li class="mr-md-4">
                        <i class="zmdi zmdi-map"></i> &nbsp; @item.DiaChi
                    </li>



                </ul>
            </div>
        </div>
        <div class="job-right my-4 flex-shrink-0">
            <button class="btn d-block w-100 d-sm-inline-block btn-light" @onclick="@(()=>GetDH(item.MaDH))" data-toggle="modal" data-target="#modalCart" title="Chi tiết và xác nhận đơn hàng">Chi tiết</button>
        </div>
    </div>          }
    </div>
   
    <div class="row">
        <div class="col">
            <Pagination MetaData="MetaData" Spread="2" SelectedPage="SelectedPage" />
        </div>
    </div>}
    else
    {
    if (Nocontent && !loading)
    {
    <span>Không có kết quả</span> }
    else
    {
    <div class="spinner-border spinner-border-sm"></div><span>Đang lấy dữ liệu</span>}


    }

</div>


<div class="modal fade" id="DetailCart" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content" style="width:900px">
            <div class="modal-header">

                <div class="col-6">
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel" style="float:right">
                        Chi tiết đơn hàng
                    </h4>
                </div>

            </div>
            @if (CTDH.Count > 0)
            {

        <div class="modal-body">
            @{ decimal? total = 0;
                int stt = 1;


        <table class="table">
            <tr>
                <th>#</th>
                <th>Thực đơn</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th></th>
            </tr>
            @foreach (var cartitem in CTDH)
            {
                var thanhtien = cartitem.SoLuong * cartitem.MaTDNavigation.Gia;
                total += thanhtien;

        <tr>
            <td>@(stt++)</td>
            <td>@cartitem.MaTDNavigation.TenMon</td>
            <td>@(cartitem.MaTDNavigation.Gia.ToString("n0").Replace(",", "."))VND</td>
            <td>@cartitem.SoLuong</td>
            <td>@(thanhtien.ToString("n0").Replace(",", "."))  VND</td>

        </tr>}
            <tr>
                <td colspan="4" class="text-right">Tổng tiền</td>
                <td><string>@(total?.ToString("n0").Replace(",", "."))  VND</string></td>
                <td></td>
            </tr>
        </table> }
        </div>
                        
                                        <div class="modal-footer">
                                            <div class="text-right">
                                                @if (DonHang.TrangThai == 1)
                                                {
                                                <button type="button" class="btn btn-sm btn-success" @onclick="()=>UpdateDH(2)"> &nbsp;Xác nhận</button>
                                                    <button type="button" class="btn btn-sm btn-info btn-warning" disabled><i class="fa fa-save"></i>&nbsp;Hoàn tất</button>
                                                                        <button type="button" class="btn btn-danger btn-sm" @onclick="@(()=>UpdateDH(4))"><i class="fa fa-close"></i>&nbsp;Huỷ đơn</button>}
                                                @if (DonHang.TrangThai == 2)
                                                {
                                <button type="button" class="btn btn-sm btn-success " disabled>&nbsp;Xác nhận</button>
                                                    <button type="button" class="btn btn-sm btn-warning"@onclick="@(()=>UpdateDH(3))"><i class="fa fa-save"></i>&nbsp;Hoàn tất</button>
                                                                        <button type="button" class="btn btn-danger btn-sm" id="btclose" disabled><i class="fa fa-close"></i>&nbsp;Huỷ đơn</button>}
                                                @if (DonHang.TrangThai ==3 || DonHang.TrangThai == 4)
                                                {
                                <button type="button" class="btn btn-sm btn-success" disabled>&nbsp;Xác nhận</button>
                                                    <button type="button" class="btn btn-sm btn-warning" disabled><i class="fa fa-save"></i>&nbsp;Hoàn tất</button>
                                                                        <button type="button" class="btn btn-danger btn-sm" id="btclose" disabled><i class="fa fa-close"></i>&nbsp;Huỷ đơn</button>}

                                            </div>

                                        </div>
                                    }


        </div>
    </div>
</div>







