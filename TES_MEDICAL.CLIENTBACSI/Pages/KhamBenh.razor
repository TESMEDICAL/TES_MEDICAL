@page "/KhamBenh/{MaPK}"


@if (phieuKham != null)
{
    <div class="col-12">
        <div class="block">
            <!-- Basic Form Elements Title -->
            <!-- END Form Elements Title -->
            <!-- Basic Form Elements Content -->
            <div enctype="multipart/form-data" class="form-horizontal p-0" onsubmit="return false;">
                <div class="block-title">
                    <h2><strong>Thông tin bệnh nhân</strong></h2>
                </div>
                <div class="form-group row">
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-email-input">Tên Bệnh Nhân</label>
                        <div class="col-md-10">
                            <h6><strong>@phieuKham.MaBNNavigation.HoTen</strong></h6>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-email-input">Số điện thoại</label>
                        <div class="col-md-10">
                            <h6><strong>@phieuKham.MaBNNavigation.SDT</strong></h6>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-text-input">Ngày sinh</label>
                        <div class="col-md-10">
                            <h6><strong>@phieuKham.MaBNNavigation.NgaySinh?.ToString("dd/MM/yyyy")</strong></h6>
                        </div>
                    </div>

                </div>
                <br />
                <div class="form-group row">
                    <div class="col-sm-4">
                        <label class="col-sm-5 control-label" for="example-select">Giới tính</label>
                        <div class="col-md-10">
                            <h6><strong>@(phieuKham.MaBNNavigation.GioiTinh?"Nữ":"Nam")</strong></h6>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <label class="col-md-5 control-label" for="example-email-input">Địa chỉ</label>
                        <div class="col-md-10">
                            <h6><strong>341/8 tổ 34-khu phố 2, phường Tân Chánh Hiệp, Quận 12, Tp. Hồ Chí Minh</strong></h6>
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-text-input">Ngày tiếp nhận</label>
                        <div class="col-md-10">
                            <h6><strong>@phieuKham.NgayKham.ToString("dd/MM/yyyy")</strong></h6>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <label class="col-md-5 control-label" for="example-email-input">Triệu chứng lâm sàn</label>
                        <div class="col-md-10">
                            <h6><strong>@(phieuKham.TrieuChungSoBo??"")</strong></h6>
                        </div>
                    </div>
                </div>
            </div>
            <br /><br />
            <div enctype="multipart/form-data" class="form-horizontal p-0 " onsubmit="return false;">
                <div class="block-title">
                    <h2><strong>Thông tin sinh hiệu</strong></h2>
                </div>
                <div class="form-group row">
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-textarea-input">Mạch</label>
                        <div class="col-md-10">
                            <input type="text" @bind="phieuKham.Mach" class="form-control" placeholder="Vui lòng nhập mạch">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-textarea-input">Huyết áp</label>
                        <div class="col-md-10">
                            <input type="text" @bind ="phieuKham.HuyetAp" class="form-control" placeholder="Vui lòng nhập huyết áp">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-md-5 control-label" for="example-textarea-input">Nhiệt độ</label>
                        <div class="col-md-10">
                            <input type="text" @bind="phieuKham.NhietDo" class="form-control" placeholder="Vui lòng nhập nhiệt độ">
                        </div>
                    </div>

                </div>
                <br /><br />
                <div class="form-group row">
                    <div class="col-sm-4">
                        <button class="btn"  @onclick="AddCtSinhHieu" style="background-color:seagreen; color: white"><i class="fa fa-plus text-white"></i>  Thêm sinh hiệu</button>
                    </div>
                    <div class="col-sm-8 row">
                        @*Vòng for khi thêm sinh hiêu: Bắt đầu*@
                        @if (chiTietSinhHieus.Count > 0)
                        {
                            @foreach (var item in chiTietSinhHieus)
                            {
                                <div class="col-sm-6 mb-2" style="width: 300px">
                                    <input type="text" class="form-control" @bind="item.TenSH" placeholder="Tên sinh hiệu">
                                </div>
                                <div class="col-sm-5 mb-2" style="width: 300px; margin-left: 60px;">
                                    <input type="text" class="form-control" @bind="item.ThongTinChiTiet" placeholder="Chỉ số">
                                </div>
                                <button class="btn btn-danger btn-sm" style="width:30px;height:30px" @onclick="()=> { var result = chiTietSinhHieus.FirstOrDefault(x => x.MaSinhHieu == item.MaSinhHieu);chiTietSinhHieus.Remove(result); }"><i class="fa fa-trash"></i></button>

                            }

                        }

                        @*Vòng for khi thêm sinh hiêu: Kết thúc*@
                    </div>
                </div>
            </div>
            <br><br />
            <div enctype="multipart/form-data" class="form-horizontal p-0 " onsubmit="return false;">
                <div class="block-title">
                    <h2><strong>Thông tin khám bệnh</strong></h2>
                </div>
                <div class="row">
                    <div class="col-sm-5" style="padding-inline: 38px;">
                        <label class="col-sm-3 control-label" for="example-textarea-input">Kết quả khám</label>
                        <div class="col-sm-12">
                            <textarea id="example-textarea-input"@bind="phieuKham.KetQuaKham" name="example-textarea-input" rows="6" class="form-control" placeholder="Nhập triệu chứng ..."></textarea>
                        </div>
                    </div>
                    <div class="col-sm-7 row">
                        <div class="col-sm-12" style="padding-inline: 38px;">
                            <label class="col-md-5 control-label" for="example-textarea-input">Chẩn đoán</label>
                            <div class="col-md-11">
                                <input type="text" class="form-control" @bind="phieuKham.ChanDoan" placeholder="Vui lòng nhập chẩn đoán">
                            </div>
                        </div>

                        <div class="col-sm-6" style="padding-inline: 38px;">
                            <label class="col-md-5 control-label" for="example-textarea-input">Ngày khám</label>
                            <div class="col-md-10">
                                <input type="date" class="form-control" @bind-value="phieuKham.NgayKham" placeholder="Vui lòng nhập ngày khám" readonly>
                            </div>
                        </div>
                        <br>
                        <div class="col-sm-6" style="padding-inline: 38px;">
                            <label class="col-md-5 control-label" for="example-textarea-input">Ngày tái khám</label>
                            <div class="col-md-10">
                                <input type="date" class="form-control" @bind="phieuKham.NgayTaiKham" placeholder="Vui lòng nhập ngày tái khám">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br /><br />
            <div enctype="multipart/form-data" class="form-horizontal p-0 " onsubmit="return false;">
                <div class="block-title">
                    <h2><strong>Lịch sử khám</strong></h2>
                </div>
                <div class="form-group">
                    <div class="form-group" style="padding-inline: 38px; text-align: right;">
                        <button class="btn" style="background-color:seagreen; width: 150px; color:white;"><i class="fa fa-eye text-white"></i>  Lịch sử khám</button>
                    </div>
                </div>
                <div class="form-group" style="margin-inline: 20px;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Ngày khám</th>
                                <td></td>
                                <td></td>
                                <th scope="col">Chẩn đoán</th>
                                <td></td>
                                <td></td>
                                <th scope="col" class="text-center">Thao tác</th>
                            </tr>
                        </thead>
                        @if (phieuKham.MaBNNavigation.PhieuKham.Count() > 0)
                        {
                            foreach (var item in phieuKham.MaBNNavigation.PhieuKham)
                            {
                                <tbody>
                                    <tr>
                                        <td>@item.NgayKham.ToString("dd/MM/yyyy")</td>
                                        <td></td>
                                        <td></td>
                                        <td>@item.ChanDoan</td>

                                        <td>
                                        </td>
                                        <td class="text-nowrap text-center">
                                            <a class="btn btn-info btn-sm active" title="Thông tin"> <i class="fa fa-info-circle" aria-hidden="true"></i></a>
                                        </td>
                                    </tr>
                                   
                                </tbody>
                            }



                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class="text-center">Không có</td>
                            </tr>
                        }
                    </table>
                        </div>
            </div>
            <br>
            <div enctype="multipart/form-data" class="form-horizontal p-0 " onsubmit="return false;">
                <div class="block-title">
                    <h2><strong>Toa thuốc</strong></h2>
                </div>
                <div class="form-group">
                    <div class="form-group" style="padding-inline: 38px; text-align: right;">
                        <button class="btn" style="background-color:seagreen;  color:white;" @onclick="GetListThuoc"><i class="fa fa-plus text-white"></i>  Thêm toa thuốc</button>
                    </div>
                </div>
                <div class="form-group" style="margin-inline: 20px;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Tên thuốc</th>
                                
                                <th scope="col">Số lượng</th>
                                
                                <th scope="col">Ghi chú</th>
                                
                              
                            </tr>
                        </thead>
                        <tbody>
                            @if (cTToaThuocs.Count == 0)
                            {
                                <tr>
                                    <td colspan="3">Chưa có thuốc trong toa</td>


                                </tr>

                            }
                            else
                            {
                                @foreach (var item in cTToaThuocs)
                                {

                                    <tr>
                                        <td>@item.Thuoc.TenThuoc</td>


                                        <td>@item.SoLuong</td>


                                        <td>@item.GhiChu</td>


                                      
                                    </tr>
                                }
                            }


                        </tbody>
                    </table>

                </div>

            </div>
            <div class="form-group" style="text-align: right; margin-right: 10px;">
                <button type="button"  class="btn btn-info"  @onclick="SendToaThuoc"><i class="far fa-check"></i>&nbsp;Xác nhận</button>
                <button type="button" class="btn btn-danger" id="btclose" data-dismiss="modal"><i class="fa fa-close"></i>&nbsp;Đóng</button>
            </div>

            <br />
        </div>

    </div>

    <!--Model chính-->
    <div id="myModal" class="modal fade">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">

                    <div class="modal-title" style="font-size: 17px;text-transform:uppercase;color:#3c8dbc"><strong id="myModalTitle"></strong></div>
                </div>
                <div class="modal-body">

                    <div id="myModalContent" class="modal-fullscreen">

                    </div>
                </div>


                <div class="modal-footer">
                    <div class="text-right">
                        <button type="button" id="btUse" class="btn btn-sm btn-success"><i class="fas fa-sync"></i>&nbsp;Dùng toa thuốc</button>
                        <button type="button" id="btSend" class="btn btn-sm btn-success"><i class="fa fa-save"></i>&nbsp;Gửi toa thuốc</button>
                        <button type="button" class="btn btn-danger btn-sm" id="btmodelclose" data-dismiss="modal"><i class="fa fa-close"></i>&nbsp;Đóng</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
}
else
{
    <div class="spinner-border spinner-border-sm"></div><span>Đang lấy dữ liệu</span>
}


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style="border-radius: 5px">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="pt-3">
                <h4 style="text-align:center; font-weight:bold">THÊM THUỐC</h4>
                <hr />
            </div>
            <!--<div class="modal-header">-->
            @*<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>*@

            <!--</div>-->
            <div class="modal-body">
                <div class="col-8 m-auto">
                    <table class="table" style="width:100%" id="danhSachThuoc">
                        <thead>
                        <tr>
                            <th class="col-8">Tên thuốc</th>
                            <th class="col-4 text-center">Thao tác</th>
                        </tr>
                        </thead>
                        <tbody>
                            @if (lisTThuoc.Count > 0)
                            {

                                @foreach (var item in lisTThuoc)
                                {
                                    <tr>
                                        <td class="col-8">@item.TenThuoc</td>
                                        <td class="col-4 text-center"><button class="btn btn-success btn-sm" style="border-radius: 60px;" @onclick="()=>AddCTToaThuoc(item.MaThuoc)"><i class="fas fa-plus"></i></button></td>
                                    </tr>
                                }
                            }
                            else
            {
    <tr><td colspan="2" class="text-center">Chưa có dữ liệu thuốc</td></tr>
            }

                        </tbody>
                    </table>
                






                </div>
                <div class="mt-5">
                    <table class="table table-striped">
                        <thead class="bg-success text-light">
                            <tr>
                                <th class="col-4">Tên thuốc</th>
                                <th class="col-2">Số lượng</th>
                                <th class="col-4">Ghi chú</th>
                                <th class="col-2 text-center">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (cTToaThuocs.Count > 0)
                            {
                                foreach (var item in cTToaThuocs)
                                {
                                    <tr>
                                        <th class="col-4">@item.Thuoc.TenThuoc</th>
                                        <th class="col-2">
                                            <div class="input-group mb-3">
                                                <input type="text" @bind="item.SoLuong" placeholder="Số lượng..." class="form-control">
                                            </div>
                                        </th>
                                        <th class="col-4">
                                            <div class="input-group mb-3">
                                                <input type="text" @bind="item.GhiChu" placeholder="Ghi chú..." class="form-control">
                                            </div>
                                        </th>
                                        <th class="col-2 text-center"><button class="btn btn-danger btn-sm" @onclick="()=>RemoveThuoc(item.Thuoc)"><i class="fa fa-trash"></i></button></th>
                                    </tr>
                                }


                            }
                            else
                            {
                                <tr>
                                    <td colspan="4">Chưa có thuốc trong toa</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success"  data-bs-dismiss="modal">OK</button>
               
            </div>
        </div>
    </div>
</div>